# The basic idea here is to check that the checkpoint capabilities of "inflow",
# "outflow", and "periodic" boundaries work correctly. Maybe this should be
# broken into separate tests in the future.
#
# It's REALLY IMPORTANT that the inflow boundary has time dependence.
# Otherwise, serialization of the inflow boundary can fail without any
# observable consequences (since the integrator may never overwrite the values
# of the ghost zone values at the inflow boundary after the restart).
#
# It also seems to be important that no boundaries use the "reflecting"
# condition (this was previously the case and the choice seemed to suppress
# issues with the inflow boundary).
#
# The testing tool automatically provides Stopping and Output sections

   Domain {
      lower = [0.0, 0.0, 0.0];
      upper = [1.0, 1.0, 1.0];
   }

   Mesh { 
      root_rank   = 3;
      root_size   = [16,16,16];
      root_blocks = [2,2,2];
   }

   Boundary {
      list = ["density_inflow", "total_energy_inflow", "VX_inflow",
              "VY_inflow", "VZ_inflow", "downwind", "yedge", "zedge"];
      density_inflow {
        face = "lower";
        axis = "x";
        type = "inflow";
        field_list = "density";
        value = 1.0;
      }
      total_energy_inflow {
        face = "lower";
        axis = "x";
        type = "inflow";
        field_list = "total_energy";
        value = [2.5 + 0.5 * (5.0 + (-1.0 - 0.05*t) * (-1.0 - 0.05*t))];
      }
      VX_inflow {
        face = "lower";
        axis = "x";
        type = "inflow";
        field_list = "velocity_x";
        value = 1.0;
      }
      VY_inflow {
        face = "lower";
        axis = "x";
        type = "inflow";
        field_list = "velocity_y";
        value = -1.0 - 0.05*t;
      }
      VZ_inflow {
        face = "lower";
        axis = "x";
        type = "inflow";
        field_list = "velocity_z";
        value = 2.0;
      }

      downwind {
         type = "outflow";
         axis = "x";
         face = "upper";
      };

      yedge {
         type = "periodic";
      };

      zedge {
         type = "periodic";
      };
   }


   Field {

      ghost_depth = 3;

      list = [
        "density",
        "velocity_x",
        "velocity_y",
        "velocity_z",
        "total_energy",
        "internal_energy",
	"pressure"
      ] ;

      gamma = 1.4;

   }

   Method {

      list = ["ppm"];

      ppm {
         courant   = 0.8;
         diffusion   = true;
         flattening  = 3;
         steepening  = true;
         dual_energy = false;
      }
   }

   Initial {

       list = ["value"];

       value {
          density       = 1.0;
          # if pressure = 1.0, then
          #    specific internal energy = 1.0/((1.4 - 1.0) * 1.0) = 2.5
          # specific kinetic energy = 0.5*v^2 = 0.5*(6) = 3.0 
          total_energy  = 5.5;
          velocity_x    = 1.0;
          velocity_y    = -1.0;
          velocity_z    = 2.0;
          internal_energy = 0.0;
       }
   }

   Stopping {
      cycle = 10;
   }